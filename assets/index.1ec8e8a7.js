(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}})();function P(n){return Math.floor(Math.random()*n)}let i;const A=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});A.decode();let m=new Uint8Array;function E(){return m.byteLength===0&&(m=new Uint8Array(i.memory.buffer)),m}function L(n,e){return A.decode(E().subarray(n,n+e))}function u(n){return n==null}let g=new Int32Array;function _(){return g.byteLength===0&&(g=new Int32Array(i.memory.buffer)),g}const w=Object.freeze({Up:0,0:"Up",Right:1,1:"Right",Down:2,2:"Down",Left:3,3:"Left"}),k=Object.freeze({Won:0,0:"Won",Lost:1,1:"Lost",Played:2,2:"Played"});class h{static __wrap(e){const o=Object.create(h.prototype);return o.ptr=e,o}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();i.__wbg_world_free(e)}static new(e,o){const c=i.world_new(!u(e),u(e)?0:e,!u(o),u(o)?0:o);return h.__wrap(c)}width(){return i.world_width(this.ptr)>>>0}reward_cell(){try{const c=i.__wbindgen_add_to_stack_pointer(-16);i.world_reward_cell(c,this.ptr);var e=_()[c/4+0],o=_()[c/4+1];return e===0?void 0:o>>>0}finally{i.__wbindgen_add_to_stack_pointer(16)}}points(){return i.world_points(this.ptr)>>>0}snake_head_index(){return i.world_snake_head_index(this.ptr)>>>0}change_snake_direction(e){i.world_change_snake_direction(this.ptr,e)}snake_cells(){return i.world_snake_cells(this.ptr)}snake_length(){return i.world_snake_length(this.ptr)>>>0}update(){i.world_update(this.ptr)}start_game(){i.world_start_game(this.ptr)}game_status(){const e=i.world_game_status(this.ptr);return e===3?void 0:e}game_status_text(){try{const c=i.__wbindgen_add_to_stack_pointer(-16);i.world_game_status_text(c,this.ptr);var e=_()[c/4+0],o=_()[c/4+1];return L(e,o)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_free(e,o)}}}async function T(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(c){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const o=await n.arrayBuffer();return await WebAssembly.instantiate(o,e)}else{const o=await WebAssembly.instantiate(n,e);return o instanceof WebAssembly.Instance?{instance:o,module:n}:o}}function q(){const n={};return n.wbg={},n.wbg.__wbg_random_06ff7eb101bdbf39=function(e){return P(e>>>0)},n.wbg.__wbindgen_throw=function(e,o){throw new Error(L(e,o))},n}function C(n,e){return i=n.exports,S.__wbindgen_wasm_module=e,g=new Int32Array,m=new Uint8Array,i}async function S(n){typeof n>"u"&&(n=new URL("/webassembly-rust-learning/assets/index_bg.863805b0.wasm",self.location));const e=q();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:o,module:c}=await T(await n,e);return C(o,c)}function F(n){return Math.floor(Math.random()*n)}async function N(){const n=await S(),e=20,o=10,c=F(o*o),r=h.new(o,c),a=r.width(),l=document.querySelector(".start-btn"),v=document.querySelector(".action-box__status-value"),R=document.querySelector(".action-box__points-value");l.onclick=()=>{r.game_status()?location.reload():(r.start_game(),b())};const d=document.getElementById("game-canvas"),t=d.getContext("2d");d.height=a*e,d.width=a*e,document.addEventListener("keydown",s=>{switch(s.code){case"ArrowUp":r.change_snake_direction(w.Up);break;case"ArrowDown":r.change_snake_direction(w.Down);break;case"ArrowLeft":r.change_snake_direction(w.Left);break;case"ArrowRight":r.change_snake_direction(w.Right);break}});function W(){t==null||t.beginPath();for(let s=0;s<=a;s++)t==null||t.moveTo(e*s,0),t==null||t.lineTo(e*s,a*e);for(let s=0;s<=a;s++)t==null||t.moveTo(0,e*s),t==null||t.lineTo(a*e,e*s);t==null||t.stroke()}function M(){const s=r.reward_cell();if(s){const f=s%a,y=Math.floor(s/a);t==null||t.beginPath(),t.fillStyle="#FF0000",t==null||t.fillRect(f*e,y*e,e,e),t==null||t.stroke()}s===1e3&&alert("you won")}function I(){const s=new Uint32Array(n.memory.buffer,r.snake_cells(),r.snake_length());s.slice().reverse().forEach((f,y)=>{const D=f%a,O=Math.floor(f/a);t.fillStyle=y===s.length-1?"#7878db":"#000000",t==null||t.beginPath(),t==null||t.fillRect(D*e,O*e,e,e)}),t==null||t.stroke()}function U(){v.textContent=r.game_status_text(),R.textContent=String(r.points())}function p(){W(),I(),M(),U()}function b(){const s=r.game_status();if(s===k.Won||s===k.Lost)return;setTimeout(()=>{t==null||t.clearRect(0,0,d.width,d.height),r.update(),p(),requestAnimationFrame(b)},1e3/3)}p()}N();
