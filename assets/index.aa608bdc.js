(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerpolicy&&(a.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?a.credentials="include":t.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();function I(n){return Math.floor(Math.random()*n)}let s;const v=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});v.decode();let w=new Uint8Array;function U(){return w.byteLength===0&&(w=new Uint8Array(s.memory.buffer)),w}function R(n,e){return v.decode(U().subarray(n,n+e))}function u(n){return n==null}let p=new Int32Array;function l(){return p.byteLength===0&&(p=new Int32Array(s.memory.buffer)),p}const g=Object.freeze({Up:0,0:"Up",Right:1,1:"Right",Down:2,2:"Down",Left:3,3:"Left"}),L=Object.freeze({Won:0,0:"Won",Lost:1,1:"Lost",Played:2,2:"Played"});class m{static __wrap(e){const r=Object.create(m.prototype);return r.ptr=e,r}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();s.__wbg_world_free(e)}static new(e,r){const o=s.world_new(!u(e),u(e)?0:e,!u(r),u(r)?0:r);return m.__wrap(o)}get_width(){return s.world_get_width(this.ptr)>>>0}get_reward_cell(){try{const o=s.__wbindgen_add_to_stack_pointer(-16);s.world_get_reward_cell(o,this.ptr);var e=l()[o/4+0],r=l()[o/4+1];return e===0?void 0:r>>>0}finally{s.__wbindgen_add_to_stack_pointer(16)}}get_points(){return s.world_get_points(this.ptr)>>>0}get_snake_head_index(){return s.world_get_snake_head_index(this.ptr)>>>0}change_snake_direction(e){s.world_change_snake_direction(this.ptr,e)}get_snake_cells(){return s.world_get_snake_cells(this.ptr)}get_snake_length(){return s.world_get_snake_length(this.ptr)>>>0}update(){s.world_update(this.ptr)}start_game(){s.world_start_game(this.ptr)}get_game_status(){const e=s.world_get_game_status(this.ptr);return e===3?void 0:e}get_game_status_text(){try{const o=s.__wbindgen_add_to_stack_pointer(-16);s.world_get_game_status_text(o,this.ptr);var e=l()[o/4+0],r=l()[o/4+1];return R(e,r)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(e,r)}}}async function D(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(o){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function O(){const n={};return n.wbg={},n.wbg.__wbg_random_06ff7eb101bdbf39=function(e){return I(e>>>0)},n.wbg.__wbindgen_throw=function(e,r){throw new Error(R(e,r))},n}function P(n,e){return s=n.exports,W.__wbindgen_wasm_module=e,p=new Int32Array,w=new Uint8Array,s}async function W(n){typeof n>"u"&&(n=new URL("/webassembly-rust-learning/assets/index_bg.1f581078.wasm",self.location));const e=O();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:o}=await D(await n,e);return P(r,o)}function T(n){return Math.floor(Math.random()*n)}function h(n){return document.querySelector(n)}function C(n,{cellSize:e,wasm:r}){const o=h("#game-canvas"),t=o.getContext("2d"),a=n.get_width();c();function c(){o.height=a*e,o.width=a*e}function d(){t==null||t.beginPath();for(let i=0;i<=a;i++)t==null||t.moveTo(e*i,0),t==null||t.lineTo(e*i,a*e);for(let i=0;i<=a;i++)t==null||t.moveTo(0,e*i),t==null||t.lineTo(a*e,e*i);t==null||t.stroke()}function y(){d(),b(),_()}function b(){const i=new Uint32Array(r.memory.buffer,n.get_snake_cells(),n.get_snake_length());i.slice().reverse().forEach((f,k)=>{const M=f%a,E=Math.floor(f/a);t.fillStyle=k===i.length-1?"#7878db":"#000000",t==null||t.beginPath(),t==null||t.fillRect(M*e,E*e,e,e)}),t==null||t.stroke()}function _(){const i=n.get_reward_cell();if(i){const f=i%a,k=Math.floor(i/a);t==null||t.beginPath(),t.fillStyle="#FF0000",t==null||t.fillRect(f*e,k*e,e,e),t==null||t.stroke()}i===1e3&&alert("you won")}return{updateWorld(){t==null||t.clearRect(0,0,o.width,o.height),y()}}}const F=20,A=5,N=T(A*A),S=3;async function q(){const n=await W(),e=h(".action-box__status-value"),r=h(".action-box__points-value"),o=h(".start-btn"),t=m.new(A,N),a=C(t,{cellSize:F,wasm:n});a.updateWorld(),o.addEventListener("click",c),document.addEventListener("keydown",y);function c(){!t.get_game_status()?(t.start_game(),d()):location.reload()}function d(){const _=t.get_game_status();_===L.Won||_===L.Lost||setTimeout(()=>{t.update(),a.updateWorld(),b(),requestAnimationFrame(d)},1e3/S)}function y(_){switch(_.code){case"ArrowUp":t.change_snake_direction(g.Up);break;case"ArrowDown":t.change_snake_direction(g.Down);break;case"ArrowLeft":t.change_snake_direction(g.Left);break;case"ArrowRight":t.change_snake_direction(g.Right);break}}function b(){e.textContent=t.get_game_status_text(),r.textContent=String(t.get_points())}}q();
