(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const _ of s.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();function D(n){return Math.floor(Math.random()*n)}function O(n){console.log(n)}let a;const E=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});E.decode();let p=new Uint8Array;function T(){return p.byteLength===0&&(p=new Uint8Array(a.memory.buffer)),p}function A(n,e){return E.decode(T().subarray(n,n+e))}function g(n){return n==null}let m=new Int32Array;function w(){return m.byteLength===0&&(m=new Int32Array(a.memory.buffer)),m}const h=Object.freeze({Up:0,0:"Up",Right:1,1:"Right",Down:2,2:"Down",Left:3,3:"Left"}),M=Object.freeze({Won:0,0:"Won",Lost:1,1:"Lost",Played:2,2:"Played"});class y{static __wrap(e){const r=Object.create(y.prototype);return r.ptr=e,r}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();a.__wbg_world_free(e)}static new(e,r){const o=a.world_new(!g(e),g(e)?0:e,!g(r),g(r)?0:r);return y.__wrap(o)}get_width(){return a.world_get_width(this.ptr)>>>0}get_reward_cell(){try{const o=a.__wbindgen_add_to_stack_pointer(-16);a.world_get_reward_cell(o,this.ptr);var e=w()[o/4+0],r=w()[o/4+1];return e===0?void 0:r>>>0}finally{a.__wbindgen_add_to_stack_pointer(16)}}get_points(){return a.world_get_points(this.ptr)>>>0}get_snake_head_index(){return a.world_get_snake_head_index(this.ptr)>>>0}change_snake_direction(e){a.world_change_snake_direction(this.ptr,e)}get_snake_cells(){return a.world_get_snake_cells(this.ptr)}get_snake_length(){return a.world_get_snake_length(this.ptr)>>>0}update(){a.world_update(this.ptr)}start_game(){a.world_start_game(this.ptr)}get_game_status(){const e=a.world_get_game_status(this.ptr);return e===3?void 0:e}get_game_status_text(){try{const o=a.__wbindgen_add_to_stack_pointer(-16);a.world_get_game_status_text(o,this.ptr);var e=w()[o/4+0],r=w()[o/4+1];return A(e,r)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_free(e,r)}}}async function C(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(o){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function N(){const n={};return n.wbg={},n.wbg.__wbg_random_06ff7eb101bdbf39=function(e){return D(e>>>0)},n.wbg.__wbg_log_0f208c11010187ce=function(e,r){try{O(A(e,r))}finally{a.__wbindgen_free(e,r)}},n.wbg.__wbindgen_throw=function(e,r){throw new Error(A(e,r))},n}function P(n,e){return a=n.exports,I.__wbindgen_wasm_module=e,m=new Int32Array,p=new Uint8Array,a}async function I(n){typeof n>"u"&&(n=new URL("/webassembly-rust-learning/assets/index_bg.c64c1866.wasm",self.location));const e=N();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:o}=await C(await n,e);return P(r,o)}function S(n){return Math.floor(Math.random()*n)}function u(n){return document.querySelector(n)}function F(n,{cellSize:e,wasm:r}){const o=u("#game-canvas"),t=o.getContext("2d"),s=n.get_width();_();function _(){o.height=s*e,o.width=s*e}function b(){l(),k(),L()}function l(){t.lineWidth=3,t.strokeStyle="#fff",t==null||t.beginPath();for(let i=0;i<=s;i++)t==null||t.moveTo(e*i,0),t==null||t.lineTo(e*i,s*e);for(let i=0;i<=s;i++)t==null||t.moveTo(0,e*i),t==null||t.lineTo(s*e,e*i);t==null||t.stroke()}function k(){const i=new Uint32Array(r.memory.buffer,n.get_snake_cells(),n.get_snake_length());i.slice().reverse().forEach((f,c)=>{const d=f%s,R=Math.floor(f/s);t.fillStyle=c===i.length-1?"#0fd945":"#ffffff",t==null||t.beginPath(),t==null||t.fillRect(d*e,R*e,e,e)}),t==null||t.stroke()}function L(){const i=n.get_reward_cell();if(i){const f=i%s,c=Math.floor(i/s);t==null||t.beginPath(),t.fillStyle="#FF0000",t==null||t.fillRect(f*e,c*e,e,e),t==null||t.stroke()}i===1e3&&alert("you won")}return{updateWorld(){t==null||t.clearRect(0,0,o.width,o.height),b()}}}const q=30,v=10,B=S(v*v),G=3;async function j(){const n=await I(),e=u("#status-value"),r=u("#points-value"),o=u(".action-btn"),t=y.new(v,B),s=F(t,{cellSize:q,wasm:n}),_=u(".mobile-control");s.updateWorld(),o.addEventListener("click",b),_==null||_.addEventListener("click",L),document.addEventListener("keydown",k);function b(){!t.get_game_status()?(t.start_game(),l()):location.reload()}function l(){const c=t.get_game_status();c===M.Won||c===M.Lost||setTimeout(()=>{t.update(),s.updateWorld(),f(),requestAnimationFrame(l)},1e3/G)}function k(c){i(c.code)}function L(c){var W;const d=c.target;if(d.tagName==="BUTTON"){const U=(W=d==null?void 0:d.dataset)==null?void 0:W.ctrl;i(U)}}function i(c){switch(c){case"ArrowUp":t.change_snake_direction(h.Up);break;case"ArrowDown":t.change_snake_direction(h.Down);break;case"ArrowLeft":t.change_snake_direction(h.Left);break;case"ArrowRight":t.change_snake_direction(h.Right);break}}function f(){e.textContent=t.get_game_status_text(),r.textContent=String(t.get_points())}}j();
