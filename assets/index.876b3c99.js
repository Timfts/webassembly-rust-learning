(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const e of r)if(e.type==="childList")for(const c of e.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const e={};return r.integrity&&(e.integrity=r.integrity),r.referrerpolicy&&(e.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?e.credentials="include":r.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(r){if(r.ep)return;r.ep=!0;const e=o(r);fetch(r.href,e)}})();function U(n){return Math.floor(Math.random()*n)}let s;const v=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});v.decode();let p=new Uint8Array;function D(){return p.byteLength===0&&(p=new Uint8Array(s.memory.buffer)),p}function R(n,t){return v.decode(D().subarray(n,n+t))}function l(n){return n==null}let h=new Int32Array;function g(){return h.byteLength===0&&(h=new Int32Array(s.memory.buffer)),h}const w=Object.freeze({Up:0,0:"Up",Right:1,1:"Right",Down:2,2:"Down",Left:3,3:"Left"}),L=Object.freeze({Won:0,0:"Won",Lost:1,1:"Lost",Played:2,2:"Played"});class y{static __wrap(t){const o=Object.create(y.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();s.__wbg_world_free(t)}static new(t,o){const a=s.world_new(!l(t),l(t)?0:t,!l(o),l(o)?0:o);return y.__wrap(a)}get_width(){return s.world_get_width(this.ptr)>>>0}get_reward_cell(){try{const a=s.__wbindgen_add_to_stack_pointer(-16);s.world_get_reward_cell(a,this.ptr);var t=g()[a/4+0],o=g()[a/4+1];return t===0?void 0:o>>>0}finally{s.__wbindgen_add_to_stack_pointer(16)}}get_points(){return s.world_get_points(this.ptr)>>>0}get_snake_head_index(){return s.world_get_snake_head_index(this.ptr)>>>0}change_snake_direction(t){s.world_change_snake_direction(this.ptr,t)}get_snake_cells(){return s.world_get_snake_cells(this.ptr)}get_snake_length(){return s.world_get_snake_length(this.ptr)>>>0}update(){s.world_update(this.ptr)}start_game(){s.world_start_game(this.ptr)}get_game_status(){const t=s.world_get_game_status(this.ptr);return t===3?void 0:t}get_game_status_text(){try{const a=s.__wbindgen_add_to_stack_pointer(-16);s.world_get_game_status_text(a,this.ptr);var t=g()[a/4+0],o=g()[a/4+1];return R(t,o)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(t,o)}}}async function O(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(a){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a);else throw a}const o=await n.arrayBuffer();return await WebAssembly.instantiate(o,t)}else{const o=await WebAssembly.instantiate(n,t);return o instanceof WebAssembly.Instance?{instance:o,module:n}:o}}function P(){const n={};return n.wbg={},n.wbg.__wbg_random_06ff7eb101bdbf39=function(t){return U(t>>>0)},n.wbg.__wbindgen_throw=function(t,o){throw new Error(R(t,o))},n}function T(n,t){return s=n.exports,W.__wbindgen_wasm_module=t,h=new Int32Array,p=new Uint8Array,s}async function W(n){typeof n>"u"&&(n=new URL("/webassembly-rust-learning/assets/index_bg.1f581078.wasm",self.location));const t=P();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:o,module:a}=await O(await n,t);return T(o,a)}function C(n){return Math.floor(Math.random()*n)}function m(n){return document.querySelector(n)}function S(n,{cellSize:t,wasm:o}){let a=n;const r=m("#game-canvas"),e=r.getContext("2d"),c=a.get_width();d(),f();function d(){r.height=c*t,r.width=c*t}function b(){e==null||e.beginPath();for(let i=0;i<=c;i++)e==null||e.moveTo(t*i,0),e==null||e.lineTo(t*i,c*t);for(let i=0;i<=c;i++)e==null||e.moveTo(0,t*i),e==null||e.lineTo(c*t,t*i);e==null||e.stroke()}function f(){b(),_(),M()}function _(){const i=new Uint32Array(o.memory.buffer,a.get_snake_cells(),a.get_snake_length());i.slice().reverse().forEach((u,k)=>{const E=u%c,I=Math.floor(u/c);e.fillStyle=k===i.length-1?"#7878db":"#000000",e==null||e.beginPath(),e==null||e.fillRect(E*t,I*t,t,t)}),e==null||e.stroke()}function M(){const i=a.get_reward_cell();if(i){const u=i%c,k=Math.floor(i/c);e==null||e.beginPath(),e.fillStyle="#FF0000",e==null||e.fillRect(u*t,k*t,t,t),e==null||e.stroke()}i===1e3&&alert("you won")}return{updateWorld(i){e==null||e.clearRect(0,0,r.width,r.height),a=i,f()}}}const F=20,A=5,N=C(A*A),q=3;async function G(){const n=await W(),t=m(".action-box__status-value"),o=m(".action-box__points-value"),a=m(".start-btn"),r=y.new(A,N),e=S(r,{cellSize:F,wasm:n});a.addEventListener("click",c),document.addEventListener("keydown",b);function c(){!r.get_game_status()?(r.start_game(),d()):location.reload()}function d(){const _=r.get_game_status();_===L.Won||_===L.Lost||setTimeout(()=>{r.update(),e.updateWorld(r),f(),requestAnimationFrame(d)},1e3/q)}function b(_){switch(_.code){case"ArrowUp":r.change_snake_direction(w.Up);break;case"ArrowDown":r.change_snake_direction(w.Down);break;case"ArrowLeft":r.change_snake_direction(w.Left);break;case"ArrowRight":r.change_snake_direction(w.Right);break}}function f(){t.textContent=r.get_game_status_text(),o.textContent=String(r.get_points())}}G();
